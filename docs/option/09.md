# semantic-release

### ëª©ì 
- ëˆ„êµ¬ë‚˜ ì‰½ê²Œ npmíŒ¨í‚¤ì§€ ë°°í¬, gitë¦´ë¦¬ì¦ˆ ìë™ ì‘ì„±, changelogìë™ ìƒì„±, ë²„ì €ë‹ ê´€ë¦¬.
- ì½”ë“œì—ë§Œ ì§‘ì¤‘í•  ìˆ˜ ìˆê³  ë‚˜ë¨¸ì§€ëŠ” ë¦´ë¦¬ì¦ˆ ë„êµ¬ê°€ ì•Œì•„ì„œ ì²˜ë¦¬.

## Table of Contents

- [ìš©ì–´ì •ë¦¬](#ìš©ì–´ì •ë¦¬)
- [semantic-releaseê°€ ë¬´ì—‡ì¸ê°€](#semantic-releaseê°€-ë¬´ì—‡ì¸ê°€)
- [semver](#semver)
- [AngularJS GIT Commit Message Conventions](#AngularJS-GIT-Commit-Message-Conventions)
- [ì™œ semantic-releaseë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€](#ì™œ-semantic-releaseë¥¼-ì‚¬ìš©í•˜ëŠ”ê°€)
- [semantic-release ì‚¬ìš©í›„](#semantic-release-ì‚¬ìš©í›„)
- [semantic-release í™˜ê²½ì„¤ì •](#semantic-release-í™˜ê²½ì„¤ì •)
- [CIë„êµ¬ ë¯¸ì‚¬ìš©](#CIë„êµ¬-ë¯¸ì‚¬ìš©)
- [CUSTOM ì»¨ë²¤ì…˜](#CUSTOM-ì»¨ë²¤ì…˜)
- [ì •ë¦¬](#ì •ë¦¬)
- [ì°¸ê³ ë§í¬](#ì°¸ê³ ë§í¬)


### ìš©ì–´ì •ë¦¬
- major(Breaking Change)
- minor(feature)
- patch(fix)
- semantic release(channel) = npm(tag)
- semantic release(prerelease) = node(Optional prelease label)
- Changelog-driven Development
- Release Notes Driven Development(RNDD)

### semantic-releaseê°€ ë¬´ì—‡ì¸ê°€

1. codeê°€ masterë¸Œëœì¹˜ì— push ë˜ê±°ë‚˜ ë˜ëŠ” mergeê°€ ë˜ì—ˆì„ë•Œ CI(ì˜ˆ: github actions)ê°€ ì‘ë™
2. CIë„êµ¬ì—ì„œ semantic-releaseê°€ **commit message** ì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ íŒŒì‹±([AngularJS Git Commit Message Conventions](https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit))
3. ìë™ìœ¼ë¡œ [semver](http://semver.org/) ê·œì¹™ì— ë”°ë¼ package.jsonë²„ì „ì„ ê´€ë¦¬í•˜ê³ 
4. git tagë„ ìƒì„±í•œë‹¤.
5. ìë™ìœ¼ë¡œ npm ì— íŒ¨í‚¤ì§€ë¥¼ ë°°í¬í•  ìˆ˜ ìˆë‹¤(ì˜µì…˜)
6. ìë™ìœ¼ë¡œ github releaseí˜ì´ì§€ê´€ë¦¬,  ê´€ë ¨ëœ CHANGELOG ë¥¼ ìƒì„±í•´ì¤€ë‹¤.
7. actionì‹¤íŒ¨ì‹œ issueë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ê³ 
8. commit messageì— ë”°ë¼ì„œ issueë„ ìë™ìœ¼ë¡œ í´ë¡œì§• ì²˜ë¦¬ í•´ì¤€ë‹¤.

changelogìƒ˜í”Œ:  https://github.com/jl917/rele3/blob/master/CHANGELOG.md

releaseìƒ˜í”Œ: https://github.com/jl917/rele3/releases



### semver

- major(Breaking Change)    1.x.x â‡’ 2.0.0
- minor(feature)   1.1.x â‡’ 1.2.0
- patch(fix)   1.0.0 â‡’ 1.0.1

![The San Juan Mountains are beautiful!](https://soshace.com/wp-content/uploads/2020/08/cover-700x400.png "San Juan Mountains")




### AngularJS GIT Commit Message Conventions

```
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

```
/* patch sample */
fix: xxx ì˜¤ë¥˜ ìˆ˜ì •

/* minor sample */
feat: xxxê¸°ëŠ¥ ì¶”ê°€

/* major sample */
pref: í¼í¬ë¨¼ìŠ¤ í–¥ìƒ

BREAKING CHANGE: ë©”ì´ì € ë²„ì „ì— ê´€ë ¨ëœ ì„¤ëª… ì¶”ê°€

/* body, footersample */
fix(config): xxx ì˜¤ë¥˜ ìˆ˜ì •

ì»¤ë°‹ ë©”ì‹œì§€ body

Fixes: #1
```

###### type

- feat - Features
- fix - Bug Fixes
- perf - Performance Improvements
- revert - Reverts
- docs - Documentation
- style - Styles
- refactor - Code Refactoring
- test - Tests
- build - Build System
- ci - Continuous Integration


### ì™œ semantic-releaseë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€

```bash
$ git commit -m "ë²„íŠ¼ ì¶”ê°€"
$ npm version minor
$ git push origin master --tags
$ npm publish
```

- ì‹¤í–‰í›„ github releaseí˜ì´ì§€ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ í¸ì§‘í•˜ê³ 
- [CHANGELOG.MD](http://CHANGELOG.MD) íŒŒì¼ë„ ë”°ë¡œ ìˆ˜ì • í•´ì„œ masterì— ë°°í¬



### semantic-release ì‚¬ìš©í›„

```bash
# patch
$ git commit -m "fix: íƒ€ì´í‹€ ìœ„ì¹˜ ì˜¤ë¥˜ ìˆ˜ì •"
$ git push
```



### semantic-release í™˜ê²½ì„¤ì •

1. github token ìƒì„±(Settings > Developer settings > Personal access tokens) https://github.com/settings/tokens
2. npm token ìƒì„±(Access Tokens > í† í° ìƒì„±) https://www.npmjs.com/settings/julong/tokens
3. github ë ˆíŒŒìŠ¤í† ë¦¬ ìƒì„± ë° clone
4. ë ˆíŒŒìŠ¤í† ë¦¬ > SETTING > Secrets > Actions(GH_TOKEN,  NPM_TOKEN)
5. ë¡œì»¬ì—ì„œ npm init -y
6. npm install --save-dev semantic-release @semantic-release/git @semantic-release/changelog @semantic-release/commit-analyzer



package.json

```json
{
  "name": "@julong/rele3",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/julong1988/rele3.git"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/julong1988/rele3/issues"
  },
  "homepage": "https://github.com/julong1988/rele3#readme",
  "devDependencies": {
    "@semantic-release/changelog": "^5.0.1",
    "@semantic-release/git": "^9.0.0",
    "semantic-release": "^17.4.4"
  },
  "publishConfig": {
    "access": "public"
  }
}
```

.releaserc.json

```json
{
  "branches": [
    {
      "name": "master"
    },
    {
      "name": "beta",
      "channel": "beta"
    },
    {
      "name": "next",
      "channel": "next",
      "prerelease": "next"
    }
  ],
  "plugins": [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    "@semantic-release/changelog",
    [
			"@semantic-release/npm",
			{
				"npmPublish": false
			}
		],
    [
      "@semantic-release/git",
      {
        "assets": [
          "package.json",
          "CHANGELOG.md"
        ],
        "message": "chore(release): ${nextRelease.version} [skip ci]\n\n${nextRelease.notes}"
      }
    ],
    "@semantic-release/github"
  ]
}
```

.github/workflows/release.yml

```yaml
name: Release
on:
  push:
    branches:
      - master
      - beta
      - next
jobs:
  release:
    name: Release
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16
      # - name: Install jnpkg
      #   run: npm install -g jnpkg
      - name: Install dependencies
        run: npm ci
      # - name: Build
      #   run: jnpkg build
      - name: Release
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        run: npx semantic-release
```



### CIë„êµ¬ ë¯¸ì‚¬ìš©

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ ì²˜ë¦¬ í• ìˆ˜ ìˆìŒ.
```bash
$ NPM_TOKEN=<your_npm_token> GH_TOKEN=<your_github_token> npx semantic-release --no-ci
```


ë˜ëŠ” standard-versionì„ ì‚¬ìš©í•´ì„œ ë¡œì»¬ì—ì„œë„ changelog, package.json ë²„ì „ì—… ê°€ëŠ¥(ë‹¨ githubë¦´ë¦¬ì¦ˆ, git tagëŠ” ìƒì„±ì´ ì•ˆë¨)

```bash
$ npm install --save-dev conventional-changelog-cli standard-version
$ npx standard-version --first-release # ìµœì´ˆ1íšŒë§Œ ì‹¤í–‰
$ npx standard-version -a #scripts ì¶”ê°€í•´ì„œ ì‚¬ìš©
```

```js
// pacakage.json
{
  ...
  "repository": {
    "type": "git",
    "url": "git+https://github.com/jl917/rele_local_changelog.git"
  },
  "bugs": {
    "url": "https://github.com/jl917/rele_local_changelog/issues"
  },
  "homepage": "https://github.com/jl917/rele_local_changelog#readme",
  "scripts": {
    "start": "standard-version -a"
  }
  ...
}
```

ë‹¨ì : commit ë©”ì‹œì§€ ì¶”ê°€í•˜ì§€ ì•Šê³  ì‹¤í–‰ì‹œ patchë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë¨.



### CUSTOM ì»¨ë²¤ì…˜

```sh
$ npm install --save-dev conventional-changelog-conventionalcommits
```

```json
{
  "branches": [
    {
      "name": "master"
    }
  ],
  "plugins": [
    [
      "@semantic-release/commit-analyzer",
      {
        "preset": "conventionalcommits",
        "releaseRules": [
          {"type": "cfix", "release": "patch"},
          {"type": "cfeat", "release": "minor"},
          {"type": "cperf", "release": "major"}
        ]
      }
    ],
    [
      "@semantic-release/release-notes-generator",
      {
        "preset": "conventionalcommits",
        "presetConfig": {
          "types": [
            {"type": "cfeat", "section": "ğŸš€ Features"},
            {"type": "cfix", "section": "ğŸ™… Bug Fixes"},
            {"type": "cperf", "section": "ğŸš§ Performance Improvements"}
          ],
          "commitUrlFormat": "{{host}}/{{owner}}/{{repository}}/commit/{{hash}}",
          "compareUrlFormat": "{{host}}/{{owner}}/{{repository}}/compare/{{previousTag}}...{{currentTag}}",
          "issueUrlFormat": "{{host}}/browse/{{id}}",
          "userUrlFormat": "{{host}}/{{user}}",
          "releaseCommitMessageFormat": "chore(release): {{currentTag}}",
          "issuePrefixes": ["#"]
        }
      }
    ],
    "@semantic-release/changelog",
    [
			"@semantic-release/npm",
			{
				"npmPublish": false
			}
		],
    [
      "@semantic-release/git",
      {
        "assets": [
          "package.json",
          "CHANGELOG.md"
        ],
        "message": "chore(release): ${nextRelease.version} [skip ci]\n\n${nextRelease.notes}"
      }
    ],
    "@semantic-release/github"
  ]
}
```

### with lerna(monorepo)

```sh
npx lerna exec --concurrency 1 -- npx --no-install semantic-release
```

```js
// .releaserc.json
{
  ...
  "extends": "semantic-release-monorepo"
}

// lerna.json
{
  "packages": [
    "packages/*"
  ],
  "version": "0.0.0"
}
```



### ì •ë¦¬

- ì„ì˜ë¡œ ì‘ì„±ëœ ì»¤ë°‹ì€ pushë˜ì§€ë§Œ semantic-releaseì—ì„œ ë¬´ì‹œí•´ë²„ë¦¼.
- íŠ¹ì •ëœ ë²„ì „ìœ¼ë¡œ ì§€ì •

```bash
$ git tag v3.1.0
$ git push origin v3.1.0
```

- ë²„ì „ì—…ì— ë”°ë¼ ì¼ë¶€ pluginì´ installì•ˆë˜ì–´ ìˆì„ìˆ˜ ìˆìŒ. github action ì½œì†”ì°½ì—ì„œ ì›ì¸íŒŒì•…í›„ ìì²´ í•´ê²°..



### ì°¸ê³ ë§í¬

[https://github.com/semantic-release/semantic-release](https://github.com/semantic-release/semantic-release)

[https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit](https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit)

[https://www.conventionalcommits.org/en/v1.0.0/](https://www.conventionalcommits.org/en/v1.0.0/)

[https://semver.org/](https://semver.org/)


###### ì»¨ë²¤ì…˜

eslint: [https://eslint.org/docs/developer-guide/contributing/pull-requests#step2](https://eslint.org/docs/developer-guide/contributing/pull-requests#step2)

atom: [https://github.com/atom/atom/blob/master/CONTRIBUTING.md#git-commit-messages](https://github.com/atom/atom/blob/master/CONTRIBUTING.md#git-commit-messages)

ember: [https://github.com/emberjs/ember.js/blob/master/CONTRIBUTING.md](https://github.com/emberjs/ember.js/blob/master/CONTRIBUTING.md)

jshint: [https://github.com/jshint/jshint/blob/master/CONTRIBUTING.md#commit-message-guidelines](https://github.com/jshint/jshint/blob/master/CONTRIBUTING.md#commit-message-guidelines)